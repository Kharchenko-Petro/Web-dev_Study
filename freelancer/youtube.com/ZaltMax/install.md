# Установка и запуск шаблона. Подготовка к работе
Категории: Документация «Чертоги Фрилансера» v3.0.0

Итак, вы скачали шаблон «Чертоги Фрилансера» v3.0.0 (далее ЧФ), какие следующие шаги?

## Установка шаблона
Первым делом следует разархивировать zip-архив в вашу папку проекта. Следите за тем, чтобы сама папка и её родительские папки не содержали в названии кириллицу, пробелы, символы # и !

Если вы до этого момента не пользовались сборщиками GULP, WEBPACK и пакетным менеджером NPM, следует скачать и установить Node.js. Качайте версию рекомендованную для большинства.

Далее, открываем терминал в этой папке проекта. Терминал может быть встроен или открыт отдельно от редактора. Рекомендую использовать терминал GIT Bash.

Если вы до этого момента не пользовались сборщиком GULP введите в терминал команду **npm i gulp-cli -g** это установит GULP в систему глобально.

После завершения установки GULP введите команду **npm i**

> В процессе установки в терминале могут возникать сообщение с пометкой WARN на желтом фоне. Эти сообщения можно игнорировать. Но, если вы получаете сообщение ERR! красным цветом — это критическая ошибка и её нужно исправлять.

Часто может возникнуть ошибка зависимостей устанавливаемых пакетов (плагинов), и в NPM выше 7й версии это приводит к критической ошибке и остановке инсталляции.

Чтобы решить проблему выполните команду **npm i --legacy-peer-deps**, это запустит процесс установки игнорируя подобные несовместимости.

> Помните — версии NodeJS и Python в вашей системе должны быть свежих версий.

После успешной установки, у вас появится папка node_modules и файл package-lock.json

Подробнее про архитектуру папок и файлов ЧФ мы поговорим в следующей главе, а пока продолжаем подготовку к работе

## Запуск шаблона и режимы работы
Шаблон «Чертоги Фрилансера» может выполнять несколько сценариев:

1. Режим разработчика. Команда запуска **npm run dev**
2. Режим продакшена. Команда запуска **npm run build**
3. Режим продакшена и отправка результата на сервер по FTP. Команда запуска **npm run deploy**
4. Режим продакшена и создание ZIP-архива с результатом. Команда запуска **npm run zip**
5. Режим продакшена без создания WEBP изображений и действий связанных с этим форматом. Команда запуска **npm run devbuild**

Дополнительные команды:

1. Ручное создание SVG спрайта. Команда запуска **npm run sprite**
2. Конвертация шрифтов с принудительной перезаписью файла стилей. Команда запуска **npm run fonts**

### Режим разработчика
В режиме разработчика выполняются только необходимые для процесса разработки задачи:

- Конвертация шрифтов и запись в файл стилей
- Конвертация SCSS файлов в CSS файлы, переименование псевдонимов
- Сборка HTML файлов, переименование псевдонимов
- При использовании PUG, файлы преобразовываются в HTML, переименовываются псевдонимы
- Собираются JS файлы
- Запускается локальный сервер, открывается браузер с индексной страницей.
- Запускается наблюдатель за изменением фалов. При каждом изменении файла браузер обновляет страницу (кроме страницы-содержания)
- Копируются файлы из указанной папки
- HTML CSS JS файлы результата не записываются на диск (**папка dist не создается**).

> Если у вас слабый ПК (мало ОЗУ) или шаблон со временем начинает тормозить, откройте файл config/webpack.dev.js и раскомментируйте блок:

	devMiddleware: {
		writeToDisk: true,
	},

> Параметр включит создание папки dist в режиме разработчика, что повышает скорость работы сборки на слабых ПК.

### Режим продакшена
В режиме продакшена выполняется финализация проекта, а именно:

- Конвертация шрифтов и запись в файл стилей
- Конвертация изображений в WEBP формат. Сжатие и оптимизация JPG PNG SVG картинок
- Конвертация SCSS файлов в CSS файлы, переименование псевдонимов, группировка медиа-запросов, добавляются вендорные префиксы для обеспечения кроссбраузерности, обрабатывается подключение WEBP изображений, производится сжатие и оптимизация конечного файла (также создается несжатая копия)
- Сборка HTML файлов, переименование псевдонимов, обрабатывается подключение WEBP изображений
- При использовании PUG, файлы преобразовываются в HTML, переименовываются псевдонимы, обрабатывается подключение WEBP изображений
- Собираются JS файлы, производится сжатие и оптимизация конечного файла. В результат попадает только используемый код. Итогом задачи будет создание двух файлов: сжатого app.min.js (подключен к HTML) и не сжатого app.js для дальнейшего редактирования другими специалистами.
- Копируются файлы из указанной папки
- Все файлы с результатом записываются на диск (обычно в папку dist), локальный сервер не запускается

> Итак, давайте же запустим наш шаблон в режиме разработчика, для этого в терминале выполняем команду **npm run dev**

После запуска система выполнет все задачи режима разработчика описанные выше. Результатом работы должна стать открытая в браузере страница содержания.

> Внимание, страница содержания не обновляется автоматически при её редактировании

## Возможные ошибки и их решения
Если браузер не запустился, а в терминале видны ошибки (ERR!) убедитесь что:

- У вас установлен Node.js и Python последней версии
- Терминал открыт с правами администратора
- В названиях папок на всем пути к проекту нет символа # или !
- Папки и файлы должны быть названы латиницей без пробелов
- Тег img и его содержимое должны быть записаны в одну строку без переносов
- В атрибуте src должен быть указан путь к существующей картинке без пробелов
При ошибке связанной с node-sass запустите команду **npm rebuild node-sass**
При ошибке связанной с Python запустите команду **npm install -g windows-build-tools**
При ошибке Error [ERR_UNSUPPORTED_ESM_URL_SCHEME]:

1. Качаем версию 14.15.1 (https://nodejs.org/dist/v14.15.1/), в Zip архиве.
2. Заходим в папку с установленным NodeJS, распаковываем содержимое архива в папку, с заменой файлов.
3. Далее идем сюда «Панель управления» => «Система» => «Дополнительные параметры системы» => «Дополнительно» => «Переменные среды»
4. В Системных переменных «Создать» переменную с именем ‘NODE_SKIP_PLATFORM_CHECK’ и присваиваем ей значение ‘1’.
5. Перезапускаем систему, и запускаем шаблон согласно инструкции

## Подготовка редактора к комфортной работе с шаблоном

> Для того чтобы наслаждаться возможностями шаблона ЧФ по полной, нам следует произвести некоторые настройки редактора. В качестве примера представлен редактор VS Code

### Настройка псевдонимов
В главе Архитектура шаблона. Файлы и папки вы узнаете что различные части HTML/PUG SCSS файлов находятся на разных уровнял вложенности, что создает определенные неудобства при подключении, например картинок, в процессе разработки.

Неудобства мы не любим поэтому настроим, так называемые, псевдонимы (алиасы) путей к папкам. Для этого нам нужно установить плагин Path Autocomplete. После установки открываем настройки редактора (settings.json), для этого жмем F1 в редакторе и в строке поиска пишем Open Settings и жмем на ссылку Open Settings (JSON).

В этот файл нужно аккуратно вставить следующий код:

	"path-autocomplete.pathMappings": {
		"@img": "${folder}/src/img", // alias for images
		"@scss": "${folder}/src/scss", // alias for scss
		"@js": "${folder}/src/js", // alias for js
	}

Очень важно соблюдать синтаксис JSON, обращайте внимания на запятые.

После этого вы смело можете использовать псевдонимы при подключении файлов, например:

	<img src="@img/cover.jpg" alt="Картинка">

Редактор распознает псевдоним и выведет список файлов в указанной папке, а во время сборки система сама поменяет псевдоним на нужный путь!

## Настройка сниппетов
Сниппеты — это короткие коды которые могут вызывать готовые заготовки кода любого объема. Это колоссально повышает скорость разработки.

Конечно же, я использовал эту супер возможность в своих чертогах. То есть, построение, например, правильной HTML структуры для того или иного JS модуля я добавил в сниппеты.

Чтобы добавить набор сниппетов из шаблона к себе в редактор выполняем следующие действия:

1. Открываем файл snnipets.txt из архива ЧФ и копируем все содержимое
2. В редакторе VS Code переходим в настройки (шестеренка) -> User Snippets ->New Global Snippets File пишем название, например fls, и заменяем содержимое на скопированное из snnipets.txt
3. При обновлении шаблона и сниппетов создавать новый файл не нужно, следует открыть существующий и обновить содержимое

Отлично, сниппеты ЧФ на борту! В этой документации, а также в коде шаблона вы часто будите встречать подсказки с указанием сниппета.

В следующей главе мы познакомимся со структурой файлов и папок шаблона «Чертоги Фрилансера» v3.0.0

Приятной работы